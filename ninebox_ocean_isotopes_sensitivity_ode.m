function dx = ninebox_ocean_isotopes_sensitivity_ode(t,x,V_1,V_2, V_3, V_4,V_5, V_6,V_7, V_8,V_9,fracA,fracP,X3,X4,fracdeni3,fracN2fix3, Ws,Wd, W15,W24,W21,W13,W34,W37,W42,W48,M36,Md,M13,M24, Mll,M37,M48, M15,M34, M29,M12,K_5, K_6,K_9, K_LL, R_5, R_6_P, R_6_D, R_LL_P, R_LL_D,R_9, x_deni,deni_3,deni_4,deni_1,deni_2,N2fix_3,N2fix_4,N2fix_1,N2fix_2, eps, eps_deni_3, eps_deni_4,eps_deni_1, eps_deni_2, R15ref, d15N_N2, N15_N2_1, N15_N2_2,N15_N2_3, N15_N2_4)

%================
% Equation being used by the ODE
%================
dx=zeros(18,1);
% 1 = Deep Indo-Pacific-South Atlantic; 2 = Deep North Atlantic; 3 = pycnocline Indo-Pacific-South Atlantic; 
% 4 = pycnocline North Atlantic; 5 = AZ surface; 6 = SAZ surface; 7 = LLML Indo-Pacific-South Atlantic; 
% 8 = LLML North Atlantic; 9 = North Atl surface

%N concentration
dx(1) = W21/V_1*x(2)-W13/V_1*x(1)-W15/V_1*x(1)+M13/V_1*(x(3)-x(1))+M15/V_1*(x(5)-x(1))+M12/V_1*(x(2)-x(1))+(W15+M15)/V_1*x(1)*K_5*R_5+W15/V_1*x(5)*K_6*R_6_D+M36/V_1*x(3)*K_6*R_6_D+(W37+M37)/V_1*x(3)*K_LL*R_LL_D+N2fix_1/V_1-deni_1/V_1;
dx(2) = W42/V_2*x(4)+(W48+W37)/V_2*x(9)-W21/V_2*x(2)-W24/V_2*x(2)+M24/V_2*(x(4)-x(2))+M29/V_2*(x(9)-x(2))+M12/V_2*(x(1)-x(2))+(M48+W48)/V_2*x(4)*K_LL*R_LL_D+W37/V_2*x(7)*K_LL*R_LL_D+M29/V_2*x(2)*K_9*R_9+(W48+W37)/V_2*x(8)*K_9*R_9+N2fix_2/V_2-deni_2/V_2;
dx(3) = W15/V_3*x(6)+W13/V_3*x(1)-W34/V_3*x(3)-W37/V_3*x(3)+M13/V_3*(x(1)-x(3))+M36/V_3*(x(6)-x(3))+M34/V_3*(x(4)-x(3))+M37/V_3*(x(7)-x(3))+W15/V_3*x(5)*K_6*R_6_P+M36/V_3*x(3)*K_6*R_6_P+(W37+M37)/V_3*x(3)*K_LL*R_LL_P+N2fix_3/V_3-deni_3/V_3;
dx(4) = W24/V_4*x(2)+W34/V_4*x(3)-W42/V_4*x(4)-W48/V_4*x(4)+M34/V_4*(x(3)-x(4))+M24/V_4*(x(2)-x(4))+M48/V_4*(x(8)-x(4))+(W48+M48)/V_4*x(4)*K_LL*R_LL_P+W37/V_4*x(7)*K_LL*R_LL_P+N2fix_4/V_4-deni_4/V_4;
dx(5) = W15/V_5*(x(1)-x(5))+M15/V_5*(x(1)-x(5))-(W15+M15)/V_5*x(1)*K_5;
dx(6) = W15/V_6*(x(5)-x(6))+M36/V_6*(x(3)-x(6))-W15/V_6*x(5)*K_6-M36/V_6*x(3)*K_6;
dx(7) = W37/V_7*(x(3)-x(7))+M37/V_7*(x(3)-x(7))-(W37+M37)/V_7*x(3)*K_LL;
dx(8) = W48/V_8*x(4)+W37/V_8*x(7)-W48/V_8*x(8)-W37/V_8*x(8)+M48/V_8*(x(4)-x(8))-(W48+M48)/V_8*x(4)*K_LL-W37/V_8*x(7)*K_LL;
dx(9) = (W48+W37)/V_9*(x(8)-x(9))+M29/V_9*(x(2)-x(9))-(W48+W37)/V_9*x(8)*K_9-M29/V_9*x(2)*K_9;

% 15N concentration 
dx(10) = W21/V_1*x(2)*x(11)/x(2)-W13/V_1*x(1)*x(10)/x(1)-W15/V_1*x(1)*x(10)/x(1)+M13/V_1*(x(3)*x(12)/x(3)-x(1)*x(10)/x(1))+M15/V_1*(x(5)*x(14)/x(5)-x(1)*x(10)/x(1))+M12/V_1*(x(2)*x(11)/x(2)-x(1)*x(10)/x(1))+(W15+M15)/V_1*x(1)*x(10)/x(1)*K_5*R_5*(1-(1-K_5)^(1-eps/1000))/K_5+W15/V_1*x(5)*x(14)/x(5)*K_6*R_6_D*(1-(1-K_6)^(1-(eps/4)/1000))/K_6+M36/V_1*x(3)*x(12)/x(3)*K_6*R_6_D*(1-(1-K_6)^(1-(eps/4)/1000))/K_6+(W37+M37)/V_1*x(3)*x(12)/x(3)*K_LL*R_LL_D*(1-(1-K_LL)^(1-eps/1000))/K_LL+N2fix_1/V_1*N15_N2_1/N2fix_1-deni_1/V_1*x(10)/x(1)*(1-eps_deni_1/1000);
dx(11) = W42/V_2*x(4)*x(13)/x(4)+(W48+W37)/V_2*x(9)*x(18)/x(9)-W21/V_2*x(2)*x(11)/x(2)-W24/V_2*x(2)*x(11)/x(2)+M24/V_2*(x(4)*x(13)/x(4)-x(2)*x(11)/x(2))+M29/V_2*(x(9)*x(18)/x(9)-x(2)*x(11)/x(2))+M12/V_2*(x(1)*x(10)/x(1)-x(2)*x(11)/x(2))+(M48+W48)/V_2*x(4)*x(13)/x(4)*K_LL*R_LL_D*(1-(1-K_LL)^(1-eps/1000))/K_LL+W37/V_2*x(7)*x(16)/x(7)*K_LL*R_LL_D*(1-(1-K_LL)^(1-eps/1000))/K_LL+M29/V_2*x(2)*x(11)/x(2)*K_9*R_9*(1-(1-K_9)^(1-eps/1000))/K_9+(W48+W37)/V_2*x(8)*x(17)/x(8)*K_9*R_9*(1-(1-K_9)^(1-eps/1000))/K_9+N2fix_2/V_2*N15_N2_2/N2fix_2-deni_2/V_2*x(11)/x(2)*(1-eps_deni_2/1000);
dx(12) = W15/V_3*x(6)*x(15)/x(6)+W13/V_3*x(1)*x(10)/x(1)-W34/V_3*x(3)*x(12)/x(3)-W37/V_3*x(3)*x(12)/x(3)+M13/V_3*(x(1)*x(10)/x(1)-x(3)*x(12)/x(3))+M36/V_3*(x(6)*x(15)/x(6)-x(3)*x(12)/x(3))+M34/V_3*(x(4)*x(13)/x(4)-x(3)*x(12)/x(3))+M37/V_3*(x(7)*x(16)/x(7)-x(3)*x(12)/x(3))+W15/V_3*x(5)*x(14)/x(5)*K_6*R_6_P*(1-(1-K_6)^(1-(eps/4)/1000))/K_6+M36/V_3*x(3)*x(12)/x(3)*K_6*R_6_P*(1-(1-K_6)^(1-(eps/4)/1000))/K_6+(W37+M37)/V_3*x(3)*x(12)/x(3)*K_LL*R_LL_P*(1-(1-K_LL)^(1-eps/1000))/K_LL+N2fix_3/V_3*N15_N2_3/N2fix_3-deni_3/V_3*x(12)/x(3)*(1-eps_deni_3/1000);
dx(13) = W24/V_4*x(2)*x(11)/x(2)+W34/V_4*x(3)*x(12)/x(3)-W42/V_4*x(4)*x(13)/x(4)-W48/V_4*x(4)*x(13)/x(4)+M34/V_4*(x(3)*x(12)/x(3)-x(4)*x(13)/x(4))+M24/V_4*(x(2)*x(11)/x(2)-x(4)*x(13)/x(4))+M48/V_4*(x(8)*x(17)/x(8)-x(4)*x(13)/x(4))+(W48+M48)/V_4*x(4)*x(13)/x(4)*K_LL*R_LL_P*(1-(1-K_LL)^(1-eps/1000))/K_LL+W37/V_4*x(7)*x(16)/x(7)*K_LL*R_LL_P*(1-(1-K_LL)^(1-eps/1000))/K_LL+N2fix_4/V_4*N15_N2_4/N2fix_4-deni_4/V_4*x(13)/x(4)*(1-eps_deni_4/1000);
dx(14) = W15/V_5*(x(1)*x(10)/x(1)-x(5)*x(14)/x(5))+M15/V_5*(x(1)*x(10)/x(1)-x(5)*x(14)/x(5))-(W15+M15)/V_5*x(1)*x(10)/x(1)*K_5*(1-(1-K_5)^(1-eps/1000))/K_5;
dx(15) = W15/V_6*(x(5)*x(14)/x(5)-x(6)*x(15)/x(6))+M36/V_6*(x(3)*x(12)/x(3)-x(6)*x(15)/x(6))-W15/V_6*x(5)*x(14)/x(5)*K_6*(1-(1-K_6)^(1-(eps/4)/1000))/K_6-M36/V_6*x(3)*x(12)/x(3)*K_6*(1-(1-K_6)^(1-(eps/4)/1000))/K_6;
dx(16) = W37/V_7*(x(3)*x(12)/x(3)-x(7)*x(16)/x(7))+M37/V_7*(x(3)*x(12)/x(3)-x(7)*x(16)/x(7))-(W37+M37)/V_7*x(3)*x(12)/x(3)*K_LL*(1-(1-K_LL)^(1-eps/1000))/K_LL;
dx(17) = W48/V_8*x(4)*x(13)/x(4)+W37/V_8*x(7)*x(16)/x(7)-W48/V_8*x(8)*x(17)/x(8)-W37/V_8*x(8)*x(17)/x(8)+M48/V_8*(x(4)*x(13)/x(4)-x(8)*x(17)/x(8))-(W48+M48)/V_8*x(4)*x(13)/x(4)*K_LL*(1-(1-K_LL)^(1-eps/1000))/K_LL-W37/V_8*x(7)*x(16)/x(7)*K_LL*(1-(1-K_LL)^(1-eps/1000))/K_LL;
dx(18) = (W48+W37)/V_9*(x(8)*x(17)/x(8)-x(9)*x(18)/x(9))+M29/V_9*(x(2)*x(11)/x(2)-x(9)*x(18)/x(9))-(W48+W37)/V_9*x(8)*x(17)/x(8)*K_9*(1-(1-K_9)^(1-eps/1000))/K_9-M29/V_9*x(2)*x(11)/x(2)*K_9*(1-(1-K_9)^(1-eps/1000))/K_9;
end
